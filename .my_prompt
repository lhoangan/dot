# inspired from https://makandracards.com/makandra/1090-customize-your-bash-prompt

source .colors.theme.bash

function make_virtualenv_prompt {
    local environ=""

    if [[ -n "$CONDA_DEFAULT_ENV" ]]; then
        environ="conda: $CONDA_DEFAULT_ENV"
    elif [[ -n "$VIRTUAL_ENV" ]]; then
        environ=$(basename "$VIRTUAL_ENV")
    fi

    green=${green#"\["}
    green=${green%"\]"}

    if [[ -n "$environ" ]]; then
        VIRENV_PROMPT="${green}[${environ}]"
    else
        VIRENV_PROMPT=""
    fi
}

function make_date_prompt {
    bold_purple=${bold_purple#"\["}
    bold_purple=${bold_purple%"\]"}

    DATE="${bold_purple}[$(date +"%Y-%m-%d %H:%M:%S")]"
}

function make_user_prompt {
    bold_blue=${bold_blue#"\["}
    bold_blue=${bold_blue%"\]"}

    ME="${bold_blue}[$(whoami)${blue}@${bold_blue}$(hostname -s)]"
}

function make_pwd_prompt {
    reset_color=${reset_color#"\["}
    reset_color=${reset_color%"\]"}

    pwd="${reset_color}${PWD}"
}


function prompt {

    # set bash prompt
    PS1="`[[ $(git status 2> /dev/null) =~ Changes\ to\ be\ committed: ]] && echo "\[\e[33m\]" || echo "\[\e[31m\]"``[[ ! $(git status 2> /dev/null) =~ nothing\ to\ commit,\ working\ .+\ clean ]] || echo "\[\e[32m\]"`$(__git_ps1 "(%s)\[\e[00m\]")${green} >${reset_color} "

    # set decoration

    blue=${blue#"\["}
    blue=${blue%"\]"}

    bold_red=${bold_red#"\["}
    bold_red=${bold_red%"\]"}

    green=${green#"\["}
    green=${green%"\]"}

    reset_color=${reset_color#"\["}
    reset_color=${reset_color%"\]"}

    make_virtualenv_prompt
    make_date_prompt
    make_user_prompt

    if [ "$?" -eq 0 ]; then STATUS="${green}✔"; else STATUS="${bold_red}✘"; fi
    echo -e "\n${DATE} ${STATUS} ${ME} ${VIRENV_PROMPT} ${bold_red}✰ ${pwd}"
}

PROMPT_COMMAND=prompt
